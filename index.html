<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Afficher un point avec un cercle fixe</title>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@5.2.0/dist/maplibre-gl.css' />
    <script src='https://unpkg.com/maplibre-gl@5.2.0/dist/maplibre-gl.js'></script>
    <style>
        body { margin: 0; padding: 0; }
        html, body, #map { height: 100%; }
    </style>
</head>
<body>
<div id="map"></div>
<script>
    const map = new maplibregl.Map({
        container: 'map',
        style: 'https://api.maptiler.com/maps/streets/style.json?key=get_your_own_OpIi9ZULNHzrESv6T2vL',
        center: [2.3522, 48.8566], // Coordonnées pour Paris
        zoom: 12
    });

    const pointCoordinates = [2.3522, 48.8566]; // Remplace par tes coordonnées

    // Fonction pour créer un cercle de 250m autour du point
    function createCircle(center, radius) {
        const points = 64; // Nombre de segments pour le cercle
        const coords = [];
        for (let i = 0; i < points; i++) {
            const angle = (i / points) * 2 * Math.PI;
            const dx = radius * Math.cos(angle) / 111320; // Convertir mètres à degrés
            const dy = radius * Math.sin(angle) / 110574; // Convertir mètres à degrés
            coords.push([center[0] + dx, center[1] + dy]);
        }
        coords.push(coords[0]); // Fermer le cercle
        return {
            type: 'Feature',
            geometry: {
                type: 'Polygon',
                coordinates: [coords]
            }
        };
    }

    // Ajout d'une source pour le point et le cercle
    map.on('load', () => {
        // Ajout du point
        map.addSource('point', {
            'type': 'geojson',
            'data': {
                'type': 'Feature',
                'geometry': {
                    'type': 'Point',
                    'coordinates': pointCoordinates
                }
            }
        });

        // Ajout du cercle de 250m
        map.addSource('circle', {
            'type': 'geojson',
            'data': createCircle(pointCoordinates, 250) // 250 mètres
        });

        // Layer pour le point
        map.addLayer({
            'id': 'point',
            'type': 'circle',
            'source': 'point',
            'paint': {
                'circle-radius': 10,
                'circle-color': '#007296'
            }
        });

        // Layer pour le cercle
        map.addLayer({
            'id': 'circle',
            'type': 'fill',
            'source': 'circle',
            'paint': {
                'fill-color': '#007296',
                'fill-opacity': 0.3
            }
        });
    });

    // Fonction pour ajuster l'angle de vue en fonction de l'orientation
    function adjustView(event) {
        const alpha = event.alpha; // Orientation autour de l'axe Z
        const beta = event.beta;   // Inclinaison avant-arrière

        // Convertir les angles en degrés pour la carte
        const pitch = beta; // Inclinaison avant-arrière
        const bearing = alpha; // Orientation

        map.setPitch(pitch);
        map.setBearing(bearing);
    }

    // Écoute l'événement d'orientation
    window.addEventListener('deviceorientation', adjustView);
</script>
</body>
</html>
