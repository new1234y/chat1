<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>Cat Chase 2025</title>
  <!-- Replace Leaflet with MapLibre GL JS -->
  <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
  <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Overlay de chargement -->
  <div id="loading-overlay">
<!-- From Uiverse.io by Nawsome --> 
<svg class="pl" viewBox="0 0 160 160" width="160px" height="160px" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="grad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#000"></stop>
      <stop offset="100%" stop-color="#fff"></stop>
    </linearGradient>
    <mask id="mask1">
      <rect x="0" y="0" width="160" height="160" fill="url(#grad)"></rect>
    </mask>
    <mask id="mask2">
      <rect x="28" y="28" width="104" height="104" fill="url(#grad)"></rect>
    </mask>
  </defs>
  
  <g>
    <g class="pl__ring-rotate">
      <circle class="pl__ring-stroke" cx="80" cy="80" r="72" fill="none" stroke="hsl(223,90%,55%)" stroke-width="16" stroke-dasharray="452.39 452.39" stroke-dashoffset="452" stroke-linecap="round" transform="rotate(-45,80,80)"></circle>
    </g>
  </g>
  <g mask="url(#mask1)">
    <g class="pl__ring-rotate">
      <circle class="pl__ring-stroke" cx="80" cy="80" r="72" fill="none" stroke="hsl(193,90%,55%)" stroke-width="16" stroke-dasharray="452.39 452.39" stroke-dashoffset="452" stroke-linecap="round" transform="rotate(-45,80,80)"></circle>
    </g>
  </g>
  
  <g>
    <g stroke-width="4" stroke-dasharray="12 12" stroke-dashoffset="12" stroke-linecap="round" transform="translate(80,80)">
      <polyline class="pl__tick" stroke="hsl(223,10%,90%)" points="0,2 0,14" transform="rotate(-135,0,0) translate(0,40)"></polyline>
      <polyline class="pl__tick" stroke="hsl(223,10%,90%)" points="0,2 0,14" transform="rotate(-90,0,0) translate(0,40)"></polyline>
      <polyline class="pl__tick" stroke="hsl(223,10%,90%)" points="0,2 0,14" transform="rotate(-45,0,0) translate(0,40)"></polyline>
      <polyline class="pl__tick" stroke="hsl(223,10%,90%)" points="0,2 0,14" transform="rotate(0,0,0) translate(0,40)"></polyline>
      <polyline class="pl__tick" stroke="hsl(223,10%,90%)" points="0,2 0,14" transform="rotate(45,0,0) translate(0,40)"></polyline>
      <polyline class="pl__tick" stroke="hsl(223,10%,90%)" points="0,2 0,14" transform="rotate(90,0,0) translate(0,40)"></polyline>
      <polyline class="pl__tick" stroke="hsl(223,10%,90%)" points="0,2 0,14" transform="rotate(135,0,0) translate(0,40)"></polyline>
      <polyline class="pl__tick" stroke="hsl(223,10%,90%)" points="0,2 0,14" transform="rotate(180,0,0) translate(0,40)"></polyline>
    </g>
  </g>
  <g mask="url(#mask1)">
    <g stroke-width="4" stroke-dasharray="12 12" stroke-dashoffset="12" stroke-linecap="round" transform="translate(80,80)">
      <polyline class="pl__tick" stroke="hsl(223,90%,80%)" points="0,2 0,14" transform="rotate(-135,0,0) translate(0,40)"></polyline>
      <polyline class="pl__tick" stroke="hsl(223,90%,80%)" points="0,2 0,14" transform="rotate(-90,0,0) translate(0,40)"></polyline>
      <polyline class="pl__tick" stroke="hsl(223,90%,80%)" points="0,2 0,14" transform="rotate(-45,0,0) translate(0,40)"></polyline>
      <polyline class="pl__tick" stroke="hsl(223,90%,80%)" points="0,2 0,14" transform="rotate(0,0,0) translate(0,40)"></polyline>
      <polyline class="pl__tick" stroke="hsl(223,90%,80%)" points="0,2 0,14" transform="rotate(45,0,0) translate(0,40)"></polyline>
      <polyline class="pl__tick" stroke="hsl(223,90%,80%)" points="0,2 0,14" transform="rotate(90,0,0) translate(0,40)"></polyline>
      <polyline class="pl__tick" stroke="hsl(223,90%,80%)" points="0,2 0,14" transform="rotate(135,0,0) translate(0,40)"></polyline>
      <polyline class="pl__tick" stroke="hsl(223,90%,80%)" points="0,2 0,14" transform="rotate(180,0,0) translate(0,40)"></polyline>
    </g>
  </g>
  
  <g>
    <g transform="translate(64,28)">
      <g class="pl__arrows" transform="rotate(45,16,52)">
        <path fill="hsl(3,90%,55%)" d="M17.998,1.506l13.892,43.594c.455,1.426-.56,2.899-1.998,2.899H2.108c-1.437,0-2.452-1.473-1.998-2.899L14.002,1.506c.64-2.008,3.356-2.008,3.996,0Z"></path>
        <path fill="hsl(223,10%,90%)" d="M14.009,102.499L.109,58.889c-.453-1.421,.559-2.889,1.991-2.889H29.899c1.433,0,2.444,1.468,1.991,2.889l-13.899,43.61c-.638,2.001-3.345,2.001-3.983,0Z"></path>
      </g>
    </g>
  </g>
  <g mask="url(#mask2)">
    <g transform="translate(64,28)">
      <g class="pl__arrows" transform="rotate(45,16,52)">
        <path fill="hsl(333,90%,55%)" d="M17.998,1.506l13.892,43.594c.455,1.426-.56,2.899-1.998,2.899H2.108c-1.437,0-2.452-1.473-1.998-2.899L14.002,1.506c.64-2.008,3.356-2.008,3.996,0Z"></path>
        <path fill="hsl(223,90%,80%)" d="M14.009,102.499L.109,58.889c-.453-1.421,.559-2.889,1.991-2.889H29.899c1.433,0,2.444,1.468,1.991,2.889l-13.899,43.61c-.638,2.001-3.345,2.001-3.983,0Z"></path>
      </g>
    </g>
  </g>
</svg>
    <p>Chargement...</p>
  </div>

  <!-- Modal de login -->
  <div id="login-modal">
    <div class="login-container">
      <h2>Rejoindre Cat Chase 2025</h2>
      <form id="join-form">
        <div class="form-group">
          <label for="player-name">Votre nom</label>
          <input type="text" id="player-name" required minlength="2" placeholder="Entrez votre nom" />
        </div>
        <!-- Replace the login form player-type select with tabs -->
        <div class="form-group">
          <label for="player-type">Type</label>
          <div class="container">
            <div class="tabs">
              <input type="radio" id="radio-1" name="tabs" checked value="player">
              <label class="tab" for="radio-1">Joueur</label>
              <input type="radio" id="radio-2" name="tabs" value="cat">
              <label class="tab" for="radio-2">Chat</label>
              <span class="glider"></span>
            </div>
          </div>
        </div>
        <button type="submit" class="btn btn-primary">Rejoindre</button>
      </form>
    </div>
  </div>

  <!-- Score module - remis en haut -->
  <div class="score-container" id="score-module">
    <div id="player-score">Score: 0</div>
  </div>

  <!-- Container for both pages -->
  <main id="main-container">
    <!-- Map Page -->
    <div id="map-page" class="page active">
      <div id="game-map"></div>
    </div>

    <!-- Players Page -->
    <div id="players-page" class="page">
      <div class="lists-container">
        <div class="list-section">
          <div class="list-header">
            <h3>Joueurs</h3>
            <span id="player-count-badge" class="badge">Joueurs: 0</span>
          </div>
          <ul id="players" class="entity-list"></ul>
        </div>
        
        <div class="list-section">
          <div class="list-header">
            <h3>Chats</h3>
            <span id="cat-count-badge" class="badge">Chats: 0</span>
          </div>
          <ul id="cats" class="entity-list"></ul>
        </div>
      </div>
      <div id="player-actions">
        <div id="switch-to-cat-container" style="display: none">
          <button id="switch-to-cat" class="btn btn-warning">Devenir un chat (-500 points)</button>
        </div>
        <button id="quit-game" class="btn btn-danger" style="display: none">Quitter la partie</button>
      </div>
    </div>
  </main>

  <!-- Map controls - déplacés en bas au-dessus de la navbar -->
  <div id="map-controls">
    <button id="center-map" class="map-control-btn">Center Map</button>
    <div class="status-container">
      <div id="status-indicator"></div>
      <span id="status-text">Connected</span>
    </div>
    <!-- Added gyroscope button -->
    <button id="enable-gyroscope" class="map-control-btn">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path>
        <path d="m2 12 10-10 10 10"></path>
        <path d="M12 2v20"></path>
      </svg>
      <span>Gyroscope 3D</span>
    </button>
    <button id="theme-toggle-button" class="theme-toggle-btn">
      <svg id="theme-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="m223.5 32c-123.5 0-223.5 100.3-223.5 224s100 224 223.5 224c60.6 0 115.5-24.2 155.8-63.4 5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6-96.9 0-175.5-78.8-175.5-176 0-65.8 36-123.1 89.3-153.3 6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"></path></svg>
    </button>
  </div>

  <!-- Bottom navigation bar -->
  <nav id="bottom-navbar">
    <button id="map-tab" class="nav-tab active">
      <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none">
        <path d="M3 7l6-3 6 3 6-3v13l-6 3-6-3-6 3V7z"></path>
        <path d="M9 4v13"></path>
        <path d="M15 7v13"></path>
      </svg>
      <span>Carte</span>
    </button>
    <button id="players-tab" class="nav-tab">
      <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none">
        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
        <circle cx="9" cy="7" r="4"></circle>
        <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
      </svg>
      <span>Joueurs</span>
    </button>
  </nav>

  <script src="script.js"></script>
</body>
</html>

